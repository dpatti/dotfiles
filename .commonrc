# Config common to .zshrc and .bashrc
# ex: ft=sh

alias ls='ls -v --classify --group-directories-first --color=auto'
alias ll='ls -l --all --human-readable'
alias cgrep='grep --color --binary-files=without-match --line-number --exclude=*.orig'
alias qgit='git'
alias each='for i in $(cat);'
alias sc='sudo systemctl'
alias scu='systemctl --user'

alias be='bundle exec'

# Default LESS parameters
export LESS="\
  --quit-if-one-screen \
  --no-init \
  --RAW-CONTROL-CHARS \
  --ignore-case \
  --LONG-PROMPT \
  --chop-long-lines \
  --tabs=2 \
"

# Shell history
export HISTSIZE=10000

# Editor
export VISUAL=vim
export EDITOR=vim

function source-if-exists {
  [ -f $1 ] && source $1
}

# PATH augmentation
function prepend-path {
  [ -d $1 ] && case ":${PATH:=$1}:" in
    *:$1:*) ;;
    *) PATH="$1:$PATH" ;;
  esac
}

prepend-path $HOME/bin
prepend-path $HOME/.local/bin
prepend-path /usr/local/heroku/bin
prepend-path $HOME/.yarn/bin

# Language managers
eval "$(rbenv init -)"
eval "$(nodenv init -)"

# Colorscheme
export BASE16_SHELL="$HOME/.config/base16-shell/base16-tomorrow.dark.sh"
source-if-exists $BASE16_SHELL

# For easy directory probing -- combines ls and less depending on the argument
unalias l 2> /dev/null
function l {
  if [ $# -eq 0 ]; then
    ls -a
  elif [ -d "$1" ]; then
    ls -a "$1"
  elif [ -f "$1" ]; then
    less "$1"
  else
    echo "Not a directory or file: $1" >&2
    return 1
  fi
}

function pkp {
  ps -ef | fzf --multi --header-lines=1 | awk '{ print $2 }' | xargs -t kill "$@"
}

function cb {
  if command -v xclip > /dev/null; then
    local copy=(xclip -selection clip-board -in)
    local paste=(xclip -selection clip-board -out)
  elif command -v pbcopy > /dev/null; then
    local copy=(pbcopy)
    local paste=(pbpaste)
  else
    echo "cb: no clipboard interface available" >&2
    return -1
  fi

  if [ ! -t 0 ]; then
    "${copy[@]}"
  else
    "${paste[@]}"
  fi
}

# This enables gnome-terminal to open a new tab in the same window
source-if-exists /etc/profile.d/vte.sh

source-if-exists $HOME/.commonrc.local
